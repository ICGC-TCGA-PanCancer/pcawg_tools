<tool id="radia_filter" name="radia_filter" version="0.1.0">
    <macros>
      <macro name="input_params">
        <param name="inputbam" label="InputBam" type="data" format="bam" help="Input BAM"/>
      </macro>
      <macro name="input_filter">
        <param name="filterfile" label="InputFile" type="data" format="bed" help="Input coordinate file"/>
      </macro>
    </macros>
    <requirements>
      <container type="docker">radia:1.1.3</container>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command interpreter="python"><![CDATA[
radia_filter.py

--outputFilename out.vcf
#if $patientId:
--patientId ${patientId}
#end if
--inputVCF ${inputVCF}
--fastaFilename ${fastaFile}

## params for normal DNA
#if $dnaNormal.use == "yes":
--dnaNormalFilename ${dnaNormal.inputbam}
--dnaNormalBaiFilename ${dnaNormal.inputbam.metadata.bam_index}
#end if

## params for tumor DNA
#if $dnaTumor.use == "yes":
--dnaTumorFilename ${dnaTumor.inputbam}
--dnaTumorBaiFilename ${dnaTumor.inputbam.metadata.bam_index}
#end if

## filters
#if $blacklist.use == "yes":
--blacklistFilename ${blacklist.filterfile}
#end if
#if $target.use == "yes":
--targetFilename ${target.filterfile}
#end if
#if $retrogenes.use == "yes":
--retroGenesFilename ${retrogenes.filterfile}
#end if
#if $pseudogenes.use == "yes":
--pseudoGenesFilename ${pseudogenes.filterfile}
#end if
#if $cosmic.use == "yes":
--cosmicFilename ${cosmic.filterfile}
#end if

--outputDir ./
--scriptsDir /opt/radia-1.1.3/scripts/

    ]]></command>
    <inputs>

      <param name="patientId" label="Patient ID" type="text" value="MyPatient" help=""/>
      <param name="inputVCF" label="Radia VCF" type="data" format="vcf" help="Radia output vcf file"/>
      <param name="fastaFile" label="Reference Genome" type="data" format="fasta" help="Fasta file used for read alignments"/>

      <conditional name="dnaNormal">
        <param name="use" type="select" label="Use DNA Normal">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_params"/>
        </when>
      </conditional>

      <conditional name="dnaTumor">
        <param name="use" type="select" label="Use DNA Tumor">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_params"/>
        </when>
      </conditional>

      <conditional name="blacklist">
        <param name="use" type="select" label="Use blacklist filter">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_filter"/>
        </when>
      </conditional>

      <conditional name="target">
        <param name="use" type="select" label="Use exon capture targets">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_filter"/>
        </when>
      </conditional>

      <conditional name="dbsnp">
        <param name="use" type="select" label="Use SNP filter">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_filter"/>
        </when>
      </conditional>

      <conditional name="retrogenes">
        <param name="use" type="select" label="Use retrogenes filter">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_filter"/>
        </when>
      </conditional>

      <conditional name="pseudogenes">
        <param name="use" type="select" label="Use pseudogenes filter">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_filter"/>
        </when>
      </conditional>

      <conditional name="cosmic">
        <param name="use" type="select" label="Use Catalogue Of Somatic Mutations In Cancer (COSMIC) annotation filter">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_filter"/>
        </when>
      </conditional>

      <conditional name="cosmic">
        <param name="use" type="select" label="Use cosmic filter">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_filter"/>
        </when>
      </conditional>

      <conditional name="target">
        <param name="use" type="select" label="Use target filter">
          <option value="yes">yes</option>
          <option value="no" selected="True">no</option>
        </param>
        <when value="yes">
          <expand macro="input_filter"/>
        </when>
      </conditional>
    </inputs>
    <outputs>
      <data name="output_vcf" format="vcf" from_work_dir="out.vcf"/>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
